<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Apache Cassandra - Study of tunable consistency</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Thomas FATTAL, Noura RABARDEAU and Alexandre TAMBORRINO">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link href='http://fonts.googleapis.com/css?family=Open+Sans:800' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/serif.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<style type="text/css">
			.with-graph {height: 100%;}
			.images{
				border: none !important; 
				box-shadow: none !important;
			}
			.highlight {
				color: white;
				background: #26351c;
				text-shadow: none;
			}
		</style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h2>Apache Cassandra</h2>
					<h4>Trade-offs between consistency and latency</h4>
				</section>

				<section>
					<h2>Apache Cassandra?</h2>
					<p>Distributed Storage System</p>
					<p>NoSQL</p>
					<p>Key-Value Model</p>
					<p>High Availability</p>
					<p>No Single Point of Failure</p>
				</section>

				<section>
					<h2>Where all began</h2>
					<p>Strong consistency &amp; low latency = DREAM</p>
					<p>But the CAP theorem says that we have to choose...</p>
					<p>What trade-off would be the best? </p>
					<p>Depends...</p>
				</section>

				<section>
					<h2>Program</h2>
					<ol>
					<li>Data model</li>
					<li>Distribution &amp; Replication model</li>
					<li>Experiments</li>
				</ol>
				</section>

				<section>
					<h2>Data Model</h2>
					<img class="images" src="images/data_model_1.png" alt="data model - first slide" />
				</section>

				<section>
					<h2>Data Model</h2>
					<img class="images" src="images/data_model_2.png" alt="data model - second slide" />
				</section>

				<section>
					<h2>Data Model</h2>
					<img class="images" src="images/data_model_3.png" alt="data model - third slide" />
				</section>

				<section>
					<h2>Distribution &amp; Replication model</h2>
					<img class="images" src="images/replication_distribution.png" alt="replication distribution">
					<p>
						<small>from <a href="http://www.datastax.com/docs/1.2/cluster_architecture/data_distribution">cassandra documentation</a> </small>
					</p>
				</section>

				<section>
					<h2>Benchmark environment</h2>
				</section>

				<section>
					<h2>CCM: Cassandra Cluster Manager</h2>
					<p>a script to easily create and destroy an Apache Cassandra cluster on localhost</p>
					<br>
					<p><a href="https://github.com/pcmanus/ccm">Open source on Github</a></p>
				</section>

				<section>
					<p>Cassandra 1.2.0</p>
					<br>
					<p>Thinkpad Intel i7 CPU, 8 GB of memory, a HDD with a rotational speed of 7200 rpm and runs a Linux 3.7.1 kernel</p>
					<br>
					<p>8 nodes and a replication factor of 3</p>
				</section>

				<section>
					<h2>Stress scenario</h2>
					<ul>
						<li>Use of <a href="http://www.datastax.com/docs/1.1/references/stress_java">Cassandra Stress</a> (part of the standard Cassandra
						 distribution)</li>
						<li>10 000 write operations followed by 10 000 read operations.</li>
						<li>1000 operation per network call, 50 client threads <br>=> very high concurrency</li>
					</ul>
				</section>

				<section>
					<h2>Experiments</h2>
				</section>

				<section>
					<p>Look at <strong>ratios and differences</strong>, not at values themselves!</p>
					<br>
					<p>(even a Thinkpad is less powerful than a data center with thousands of 32-core machines, isn't it?)</p>
				</section>

				<section>
					<h2>Strong consistency</h2>
					<p>We need R + W > 3. Possible configurations:
						<ul>
							<li>R=1, W=3 (read-intensive)</li>
							<li>R=3, W=1 (read-intensive)</li>
							<li>R=2, W=2 (in-between)</li>
						</ul>
					<p>
				</section>

				<section class="with-graph">
					<h2>Strong consistency</h2>
					<iframe src="graphs/strongConsistency.html" height="100%" width="100%" scrolling="no" frameborder="0"></iframe>
				</section>

				<section>
					<h3>But what if our application needs <em>low latency</em> more than strong consistency?</h3>
				</section>

				<section>
					<h2>Weak consistency</h2>
						<p>R + W &le; 3. Possible configurations:
							<ul>
								<li>R=1, W=2</li>
								<li>R=2, W=1</li>
								<li>R=1, W=1 (weakest consistency)</li>
							</ul>
						</p>
				</section>

				<section class="with-graph">
					<h2>Weak consistency</h2>
					<iframe src="graphs/weakConsistency.html" height="100%" width="100%" scrolling="no" frameborder="0"></iframe>
				</section>

				<section class="with-graph">
					<h2>Comparison</h2>
					<iframe src="graphs/compStrongWeakConsistency.html" height="100%" width="100%" scrolling="no" frameborder="0"></iframe>
				</section>

				<section>
					<p>But... R and W are parameters. They don't make sense for an application developer like the latency does.</p>
					<p>We need <em>better metrics</em> to measure weak consistency</p>
				</section>

				<section>
					<h3>Solution: <em>Probabilistically Bounded Staleness</em></h3>
				</section>

				<section>
					<p>PBS is an algorithm developed at UC Berkeley that allows to make predictions about the <em>probability of consistent reads</em> for Dynamo-style quorum replication</p>
				</section>

				<section>
					<h2>2 main parameters</h2>
					<ul>
						<li><strong>t-visibility</strong> models the probability that we will read a value t seconds after its write completes.</li>
						<li><strong>k-staleness</strong> models the probability that we will read a value that is no more than k versions older than the last written version.</li>
					</ul>
				</section>

				<section>
					<p>t-visibility answers to the question <br><em>How eventual is eventual consistency?</em></p>
					<br>
					<p>k-staleness answers to the question <br><em>How consistent is eventual consistency?</em></p>
				</section>

				<section class="with-graph">
					<h3>k-staleness = 1</h3>
					<iframe src="graphs/readConsistencyafterNms.html" height="100%" width="100%" scrolling="no" frameborder="0"></iframe>
				</section>

				<section class="with-graph">
					<h3>t-visibility = 100 ms</h3>
					<iframe src="graphs/maxStalenessafterNms.html" height="100%" width="100%" scrolling="no" frameborder="0"></iframe>
				</section>

				<section>
					<p>PBS gives metrics for measuring consistency that <em>make sense</em> for a developer who wants to configure Cassandra according to his
						application needs.</p>
				</section>

				<section>
					<h2>Future work</h2>
					<p>Experiment on a real cluster with physical nodes</p>
					<p>Take into account join/failure of nodes</p>
				</section>

				<section>
					<h1>THE END</h1>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>
		<script src="plugin/jquery/jquery.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

			Reveal.addEventListener( 'slidechanged', function( event ) {
			    // event.previousSlide, event.currentSlide, event.indexh, event.indexv
			    // event.indexh

			    var section = $('div.slides').children('section')[event.indexh];
			    $(section).children('iframe').each(function() {
				var src = this.src;
				this.src = src;
			});

			});

		</script>

	</body>
</html>
